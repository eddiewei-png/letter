<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Our Memories üå∏</title>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

<style>
  body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    background: linear-gradient(135deg, #000 0%, #1a1a1a 50%, #000 100%);
  }

  .slideshow-container {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    cursor: pointer;
  }

.slide {
  position: absolute;
  top: 50%;
  left: 50%;
  opacity: 0;
  transition: opacity 2s ease, transform 6s ease;
  transform: translate(-50%, -50%);
}

.landscape {
  width: 100vw;
  height: auto;
  max-height: 100vh;
  object-fit: contain;
}

.portrait {
  width: auto;
  height: 100vh;
  max-width: 100vw;
  object-fit: contain;
}

.slide.active {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1.03);
}

.small-slide {
  object-fit: contain;
  scale: 0.9;
}

  .overlay {
    position: absolute;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(0,0,0,0.25), rgba(0,0,0,0.65));
    z-index: 1;
  }

  .caption {
    position: absolute;
    bottom: 10%;
    width: 100%;
    text-align: center;
    font-family: 'Great Vibes', cursive;
    font-size: clamp(26px, 4vw, 50px);
    color: #ffe6f0;
    text-shadow: 0 0 15px rgba(255,192,203,0.9);
    z-index: 2;
  }

  .controls {
    position: absolute;
    top: 20px; right: 20px;
    z-index: 3;
    display: flex;
    gap: 10px;
  }

  .btn {
    background: rgba(255,255,255,0.2);
    border: none;
    border-radius: 50%;
    width: 50px; height: 50px;
    color: #fff;
    font-size: 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .btn:hover {
    background: rgba(255,255,255,0.4);
    box-shadow: 0 0 15px rgba(255,192,203,0.7);
  }
  
#backBtn {
  animation: pulseGlow 2.8s ease-in-out infinite;
  text-shadow: 0 0 10px rgba(255,182,193,0.7);
}

@keyframes pulseGlow {
  0% {
    transform: scale(1);
    box-shadow: 0 0 12px rgba(255,182,193,0.5);
  }
  50% {
    transform: scale(1.08);
    box-shadow: 0 0 20px rgba(255,192,203,0.9);
  }
  100% {
    transform: scale(1);
    box-shadow: 0 0 12px rgba(255,182,193,0.5);
  }
}

  #backBtn:hover {
    opacity: 0.7;
  }

  .progress {
    position: absolute;
    bottom: 5%;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 6px;
    z-index: 3;
  }

  .dot {
    width: 10px;
    height: 10px;
    background: rgba(255,192,203,0.5);
    border-radius: 50%;
    transition: background 0.3s ease;
  }

  .dot.active {
    background: #ff69b4;
  }
#musicOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  cursor: pointer;
  transition: opacity 1s ease;
}

#musicText {
  font-family: 'Great Vibes', cursive;
  color: #ffb6c1;
  font-size: clamp(28px, 5vw, 50px);
  text-shadow: 0 0 15px rgba(255,192,203,0.9);
  animation: pulse 2s infinite ease-in-out;
}

@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.6; transform: scale(1.1); }
}

#musicOverlay.fade-out {
  opacity: 0;
  pointer-events: none;
}

  #fireworksCanvas {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 9998;
  display: none;
}

</style>
</head>

<body>
<canvas id="fireworksCanvas"></canvas>
<div class="slideshow-container" id="slideshow">
  <!-- Intro Slide -->
  <img src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1200&q=80" class="slide active" alt="Intro">

  <!-- Main Slides -->
  <img src="https://github.com/ninomiyashina/letter/raw/main/my-gallery/img2.jpg" class="slide" alt="Memory 1">
  <img src="https://github.com/ninomiyashina/letter/raw/main/my-gallery/img3.jpg" class="slide" alt="Memory 2">
  <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1200&q=80" class="slide" alt="Memory 3">
  <img src="https://github.com/ninomiyashina/letter/raw/main/my-gallery/img4.jpg" class="slide" alt="Memory 4">
  <img src="https://github.com/ninomiyashina/letter/raw/main/my-gallery/img8.jpeg" class="slide" alt="Memory 6">
    <img src="https://github.com/ninomiyashina/letter/raw/main/my-gallery/img9.jpeg" class="slide" alt="Memory 7">
  <img src="https://github.com/ninomiyashina/letter/raw/main/my-gallery/img5.jpg" class="slide" alt="Memory 5">


  <!-- Closing Slide -->
  <img src="https://github.com/ninomiyashina/letter/raw/main/my-gallery/img1.jpg" class="slide" alt="Closing">

  <div class="overlay"></div>
  <div class="caption" id="caption">Welcome to our memories üíñ</div>

  <div class="controls">
    <button class="btn" id="pauseBtn">‚è∏</button>
    <button class="btn" id="backBtn">üíå</button>
    <button class="btn" id="musicBtn">üéµ</button>
  </div>

  <div class="progress" id="progress"></div>
</div>

<!-- Page turn sound -->
<audio id="pageTurnSound">
  <source src="https://www.soundjay.com/button/sounds/button-16.mp3" type="audio/mpeg">
</audio>
<audio id="bgMusic" loop preload="auto">
  <source src="YisaYu-LiXian.mp3" type="audio/mpeg">
</audio>
  <!-- Tap-to-start overlay -->
<div id="musicOverlay">
  <div id="musicText">Tap to begin~ üòä</div>
</div>
<script>

const slides = document.querySelectorAll('.slide');
  // Detect portrait vs landscape and assign correct class
slides.forEach(slide => {
  slide.addEventListener('load', () => {
    if (slide.naturalWidth > slide.naturalHeight) {
      slide.classList.add('landscape');
      slide.classList.remove('portrait');
    } else {
      slide.classList.add('portrait');
      slide.classList.remove('landscape');
    }
  });
});

const caption = document.getElementById('caption');
const pauseBtn = document.getElementById('pauseBtn');
const backBtn = document.getElementById('backBtn');
const pageTurn = document.getElementById('pageTurnSound');

let current = 0;
let playing = true;
let interval;
let fireworkInterval = null;   // ‚úÖ 
let fireworksStarted = false; // ‚úÖ 

const captions = [
  "Hi dear, made this specially for our love story üíñ",
  "23/08/2025 - Still remember the first day when we met? It was my happiest day that time",
  "07/10/2025 - It still felt like a dream when you accepted me üòä",
  "11/10/2025 - Your smile makes my world brighter ‚ú®",
  "11/10/2025 - Celebrating your special day means a lot to me üéÇ", 
  "07/11/2025 - Happy monthsary dear! Though the flowers did not end up well üòÖ",
  "07/11/2025 - Back to where when our love story first started! ‚ù§Ô∏è",
  "Love you more every single day üíû",
  "Looking forward to our future together ‚Äì Eddie üíå"
];

// Progress dots
const progressContainer = document.getElementById('progress');
slides.forEach(()=> {
  const dot = document.createElement('div');
  dot.classList.add('dot');
  progressContainer.appendChild(dot);
});
const dots = document.querySelectorAll('.dot');

function showSlide(index) {
  slides.forEach((slide, i) => slide.classList.toggle('active', i === index));
  caption.textContent = captions[index];
  dots.forEach((dot, i) => dot.classList.toggle('active', i === index));

  if (index === slides.length - 1 && !fireworksStarted) {
  fireworksStarted = true;

  fwCanvas.style.display = 'block';

 fireworkInterval = setInterval(() => {
  launchRocket(Math.random() > 0.5);
}, 900);

  animateFireworks();
  stopSlideshow();
  stopFireworksAfter(18000);   // auto fade out after 18s
}
}

function playPageTurnSound() {
  pageTurn.currentTime = 0;
  pageTurn.play().catch(()=>{});
}

function nextSlide() {
  playPageTurnSound();
  current = (current + 1) % slides.length;
  showSlide(current);
}

function prevSlide() {
  playPageTurnSound();
  current = (current - 1 + slides.length) % slides.length;
  showSlide(current);
}

function startSlideshow() {
  clearInterval(interval);
  interval = setInterval(nextSlide, 5000);
}

function stopSlideshow() {
  clearInterval(interval);
}

const bgMusic = document.getElementById('bgMusic');
const musicBtn = document.getElementById('musicBtn');
let musicPlaying = false;

// Music control toggle
musicBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  if (musicPlaying) {
    bgMusic.pause();
    musicBtn.textContent = 'üîá';
  } else {
    bgMusic.play().catch(()=>{});
    musicBtn.textContent = 'üéµ';
  }
  musicPlaying = !musicPlaying;
});

// Try to start music after first user interaction (required by browsers)
/*document.body.addEventListener('click', () => {
  if (!musicPlaying) {
    bgMusic.play().catch(()=>{});
    musicBtn.textContent = 'üéµ';
    musicPlaying = true;
  }
}, { once: true });
*/
// --- CLICK NAVIGATION ---
document.getElementById('slideshow').addEventListener('click', (e) => {
  const rect = e.currentTarget.getBoundingClientRect();
  const x = e.clientX - rect.left;
  if (x < rect.width / 2) {
    prevSlide();
  } else {
    nextSlide();
  }
  if (playing) startSlideshow();
});

// --- KEYBOARD NAVIGATION ---
document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowLeft') {
    prevSlide();
    if (playing) startSlideshow();
  } else if (e.key === 'ArrowRight') {
    nextSlide();
    if (playing) startSlideshow();
  } else if (e.key === ' ') { // Spacebar pause/play
    e.preventDefault();
    pauseBtn.click();
  }
});

// Pause/play button
pauseBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  if (playing) {
    stopSlideshow();
    pauseBtn.textContent = '‚ñ∂Ô∏è';
  } else {
    startSlideshow();
    pauseBtn.textContent = '‚è∏';
  }
  playing = !playing;
});

// Back to index.html
backBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  window.location.href = "index.html";
});

// Intro -> start main slideshow
function startIntro() {
  showSlide(0);
  setTimeout(()=>{
    current = 1;
    showSlide(current);
    startSlideshow();
  }, 3000); // 3s intro
}

// Start the slideshow
//startIntro();

// Music overlay behavior
const overlay = document.getElementById('musicOverlay');
overlay.addEventListener('click', () => {
  overlay.classList.add('fade-out');
  setTimeout(() => overlay.remove(), 1000); // remove after fade-out

  // Start music safely
  bgMusic.play().catch(()=>{});
  musicBtn.textContent = 'üéµ';
  musicPlaying = true;

  stopSlideshow();

  // Start intro slideshow after music begins
  startIntro();
}, { once: true });

  const fwCanvas = document.getElementById('fireworksCanvas');
const fwCtx = fwCanvas.getContext('2d');
fwCanvas.width = window.innerWidth;
fwCanvas.height = window.innerHeight;

window.addEventListener('resize', () => {
  fwCanvas.width = window.innerWidth;
  fwCanvas.height = window.innerHeight;
});

let fireworks = [];
let rockets = [];
let sparkles = [];

function launchFirework(isHeart = false) {
  const cx = Math.random() * fwCanvas.width;
  const cy = Math.random() * fwCanvas.height * 0.45;

  const count = isHeart ? 120 : 80;

  for (let i = 0; i < count; i++) {
    let angle, speed;

    if (isHeart) {
      // parametric heart shape
      const t = Math.random() * Math.PI * 2;
      const x = 16 * Math.pow(Math.sin(t), 3);
      const y =
        -(13 * Math.cos(t) -
          5 * Math.cos(2 * t) -
          2 * Math.cos(3 * t) -
          Math.cos(4 * t));

      angle = Math.atan2(y, x);
      speed = Math.random() * 2 + 1;
    } else {
      angle = Math.random() * Math.PI * 2;
      speed = Math.random() * 4 + 1;
    }

    fireworks.push({
      x: cx,
      y: cy,
      angle,
      speed,
      radius: Math.random() * 2 + 1.8,
      life: 120,
      color: `hsl(${Math.random() * 360},100%,65%)`,
      alpha: 1
    });
  }
}
  
 function launchRocket(isHeart = false) {
  const peak = Math.random() * fwCanvas.height * 0.4 + fwCanvas.height * 0.15;

  rockets.push({
    x: Math.random() * fwCanvas.width,
    y: fwCanvas.height,
    vy: Math.random() * -10 - 12,
    explodeAt: peak,
    isHeart,
    trailHue: Math.random() * 360
  });
}

function animateFireworks() {
  fwCtx.clearRect(0, 0, fwCanvas.width, fwCanvas.height);

  // üöÄ Rockets
  rockets.forEach((r, i) => {
    r.y += r.vy;
    r.vy += 0.18;

    // trail
    sparkles.push({
      x: r.x,
      y: r.y,
      vx: (Math.random() - 0.5) * 1.5,
      vy: Math.random() * 1.5,
      life: 30,
      color: `hsl(${r.trailHue},100%,70%)`
    });

    // rocket dot
    fwCtx.fillStyle = "white";
    fwCtx.beginPath();
    fwCtx.arc(r.x, r.y, 2, 0, Math.PI * 2);
    fwCtx.fill();

    // explode exactly at peak
    if (r.vy >= 0) {
      launchFirework(r.isHeart);
      rockets.splice(i, 1);
    }
  });

  // ‚ú® Sparkles
  sparkles.forEach((s, i) => {
    s.x += s.vx;
    s.y += s.vy;
    s.life--;

    fwCtx.globalAlpha = s.life / 30;
    fwCtx.fillStyle = s.color;
    fwCtx.beginPath();
    fwCtx.arc(s.x, s.y, 2, 0, Math.PI * 2);
    fwCtx.fill();

    if (s.life <= 0) sparkles.splice(i, 1);
  });

  // üí• Firework particles
  fireworks.forEach((p, i) => {
    p.x += Math.cos(p.angle) * p.speed;
    p.y += Math.sin(p.angle) * p.speed + 0.4;
    p.life--;
    p.alpha -= 0.01;

    fwCtx.fillStyle = p.color;
    fwCtx.globalAlpha = Math.max(p.alpha, 0);
    fwCtx.beginPath();
    fwCtx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
    fwCtx.fill();

    if (p.life <= 0) fireworks.splice(i, 1);
  });

  fwCtx.globalAlpha = 1;
  requestAnimationFrame(animateFireworks);
}

  function finalHeartExplosion() {
  const cx = fwCanvas.width / 2;
  const cy = fwCanvas.height * 0.4;

  for (let i = 0; i < 6; i++) {
    setTimeout(() => {
      launchFirework(true);
    }, i * 600);
  }
}  
  
  function stopFireworksAfter(ms = 15000) {
  setTimeout(() => {
    finalHeartExplosion();

    setTimeout(() => {
      clearInterval(fireworkInterval);
      fwCanvas.style.opacity = 0;
      fwCanvas.style.transition = 'opacity 3s ease';

      setTimeout(() => {
        fwCanvas.style.display = 'none';
        fwCanvas.style.opacity = 1;
      }, 3000);
    }, 4000);
  }, ms);
}

</script>
  
</body>
</html>
