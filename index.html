<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Letter Project</title>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
body, html {
  margin:0;
  padding:0;
  font-family:'Segoe UI',sans-serif;
  background:#fff0f5;
  overflow:hidden;
}

/* --- Start Page --- */
.start-wrapper {
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  z-index:100;
}
.start-container { display:flex; flex-direction:column; align-items:center; gap:12px; text-align:center; }
#click-hint {
  font-size:2.4rem;
  color:#ff69b4;
  text-shadow:0 0 8px #ff69b4,0 0 15px #ff1493;
  animation:beat 1.2s infinite;
  pointer-events:none;
}
@keyframes beat {0%,100%{transform:scale(1);}50%{transform:scale(1.15);} }
@keyframes wiggle {
  0%,100%{transform:rotate(0deg);}
  15%{transform:rotate(-8deg);}
  30%{transform:rotate(6deg);}
  45%{transform:rotate(-6deg);}
  60%{transform:rotate(5deg);}
  75%{transform:rotate(-3deg);}
}
#startBtn { cursor:pointer; border:none; background:none; width:160px; height:160px; }
#startBtn img {
  width:100%; height:100%;
  border-radius:50%;
  filter: drop-shadow(0 0 12px rgba(255,105,180,0.7));
  animation:wiggle 1.5s infinite ease-in-out;
}

.fade-out {animation:fadeOut 1.8s forwards ease-in-out;}
@keyframes fadeOut {from{opacity:1;transform:scale(1);} to{opacity:0; transform:scale(0.8);} }

/* --- Letter Container --- */
#container {
  opacity: 0;
  pointer-events: none;
  width: 90vw;
  max-width: 360px;
  aspect-ratio: 360 / 650;
  margin: 20px auto;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(250,50,120,0.2);
  background: url("stellalou-letter-bg.png") no-repeat center top;
  background-size: 100% 100%;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  transition: opacity 1s ease-in;
  z-index: 10;
  overflow: hidden;
}
#container.show { opacity:1; pointer-events:auto; }

#letter-wrapper { flex:1; overflow-y:auto; padding:40px; box-sizing:border-box; scrollbar-width:none; }
#letter-wrapper::-webkit-scrollbar { display:none; }

#letter { font-family:'Georgia', serif; font-size:1.4rem; color:#E8C1E5; white-space:pre-wrap; position:relative; }
#letter p { margin:1.2em 0; position:relative; }

@keyframes fadeOutToPink {
  0% {opacity:1;background-color:transparent;filter:brightness(1);}
  80% {opacity:0.3;background-color:rgba(255,182,193,0.4);filter:brightness(1.2);}
  100% {opacity:0;background-color:rgba(255,182,193,0.6);filter:brightness(1.4);}
}
#container.fade-out {animation:fadeOutToPink 3s ease forwards;}

/* --- Heart Animation --- */
#heart-container {
  position:fixed;
  left:50%; top:50%;
  transform:translate(-50%,-50%);
  z-index:50;
  display:none;
  opacity:0;
  transition:opacity 2s ease-in-out;
}
#heart-container.show { opacity:1; }

#loveHeart {
  position: relative;
  width: 100%;
  height: 100vh;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
}
#garden {
  position: absolute;
  top: 0; left: 0;
}
#words {
  position: absolute;
  text-align: center;
  color: #ff69b4;
  font-family: 'Great Vibes', cursive;
  font-size: 2rem;
  text-shadow: 0 0 10px rgba(255,182,193,0.7);
  pointer-events: none;
}
</style>
</head>

<body>

<!-- ðŸŒ¸ Start Page -->
<div class="start-wrapper">
  <div class="start-container" id="start-container">
    <div id="click-hint">Click Here <br> â†“</div>
    <button id="startBtn"><img src="stella.png" alt="Start"></button>
  </div>
</div>

<!-- ðŸ’Œ Letter -->
<div id="container">
  <div id="letter-wrapper">
    <h1>My Dearest</h1>
    <div id="letter">
      <p>Every heartbeat writes a line of poetry just for you...</p>
      <p>Even when miles apart, our hearts stay intertwined.</p>
      <p>And when this letter ends, something beautiful will bloom. ðŸŒ¸</p>
    </div>
  </div>
  <audio id="background-music" loop>
    <source src="https://github.com/eddiewei-png/letter/raw/refs/heads/main/piano music.mp3" type="audio/mpeg">
  </audio>
</div>

<!-- â¤ï¸ Heart Animation -->
<div id="heart-container">
  <div id="loveHeart">
    <canvas id="garden" width="1200" height="1200"></canvas>
    <div id="words">
      <div id="messages">My heart blooms for you</div>
      <div id="loveu">Love you always</div>
    </div>
  </div>
</div>

<script>
/* ---------------- Friendâ€™s Heart Flower Code ---------------- */
function Garden(ctx, element) {
  this.blooms = [];
  this.element = element;
  this.ctx = ctx;
}
Garden.options = { growSpeed: 1000 / 60 };
Garden.prototype.createRandomBloom = function (x, y) {
  const r = Math.random() * 10 + 4;
  const color = "rgba(" + (200 + Math.random() * 55) + "," + (100 + Math.random() * 100) + "," + (150 + Math.random() * 100) + ",0.8)";
  this.blooms.push({x, y, r, color});
};
Garden.prototype.render = function () {
  this.ctx.clearRect(0, 0, this.element.width, this.element.height);
  for (const b of this.blooms) {
    this.ctx.beginPath();
    this.ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
    this.ctx.fillStyle = b.color;
    this.ctx.fill();
  }
};

var garden, gardenCtx, gardenCanvas, offsetX, offsetY;

$(function () {
  var $loveHeart = $("#loveHeart");
  offsetX = $loveHeart.width() / 2;
  offsetY = $loveHeart.height() / 2 - 55;
  gardenCanvas = $("#garden")[0];
  gardenCanvas.width = $loveHeart.width();
  gardenCanvas.height = $loveHeart.height();
  gardenCtx = gardenCanvas.getContext("2d");
  garden = new Garden(gardenCtx, gardenCanvas);
  setInterval(function () { garden.render(); }, Garden.options.growSpeed);
});

function getHeartPoint(c) {
  var t = c / Math.PI;
  var x = 19.5 * (16 * Math.pow(Math.sin(t), 3));
  var y = -20 * (13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));
  return [offsetX + x, offsetY + y];
}

function startHeartAnimation() {
  var c = 50, d = 10, points = [];
  var anim = setInterval(function () {
    var pos = getHeartPoint(d);
    var valid = true;
    for (var i = 0; i < points.length; i++) {
      var p = points[i];
      if (Math.sqrt(Math.pow(p[0] - pos[0], 2) + Math.pow(p[1] - pos[1], 2)) < 10) { valid = false; break; }
    }
    if (valid) {
      points.push(pos);
      garden.createRandomBloom(pos[0], pos[1]);
    }
    if (d >= 30) { clearInterval(anim); showMessages(); }
    else { d += 0.2; }
  }, c);
}

function showMessages() {
  $("#messages").fadeIn(2000, function () {
    $("#loveu").fadeIn(2000);
  });
}

/* ---------------- Typewriter Effect ---------------- */
(function ($) {
  $.fn.typewriter = function () {
    this.each(function () {
      var $el = $(this), content = $el.html(), progress = 0;
      $el.html("");
      var timer = setInterval(function () {
        var char = content.substr(progress, 1);
        if (char == "<") progress = content.indexOf(">", progress) + 1;
        else progress++;
        $el.html(content.substring(0, progress) + (progress & 1 ? "_" : ""));
        if (progress >= content.length) clearInterval(timer);
      }, 75);
    });
    return this;
  };
})(jQuery);

/* ---------------- Page Logic ---------------- */
document.getElementById("startBtn").addEventListener("click", () => {
  const start = document.getElementById("start-container");
  start.classList.add("fade-out");
  setTimeout(() => {
    document.getElementById("container").classList.add("show");
    document.getElementById("background-music").play();
    $("#letter").typewriter();
    setTimeout(() => {
      document.getElementById("container").classList.add("fade-out");
      setTimeout(() => {
        const heart = document.getElementById("heart-container");
        heart.style.display = "block";
        heart.classList.add("show");
        startHeartAnimation();
      }, 3000);
    }, 12000);
  }, 1800);
});
</script>

</body>
</html>
