<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Letter Project</title>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
body, html {
  margin:0; padding:0;
  font-family:'Segoe UI',sans-serif;
  background:#fff0f5;
  overflow:hidden;
}

.start-wrapper {
  position:absolute; top:50%; left:50%;
  transform:translate(-50%,-50%);
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  z-index:100;
}
.start-container { display:flex; flex-direction:column; align-items:center; gap:12px; text-align:center; }
#click-hint { font-size:2.4rem; color:#ff69b4; text-shadow:0 0 8px #ff69b4,0 0 15px #ff1493; animation:beat 1.2s infinite; pointer-events:none; }
@keyframes beat {0%,100%{transform:scale(1);}50%{transform:scale(1.15);} }

@keyframes wiggle {0%,100%{transform:rotate(0deg);}15%{transform:rotate(-8deg);}30%{transform:rotate(6deg);}45%{transform:rotate(-6deg);}60%{transform:rotate(5deg);}75%{transform:rotate(-3deg);} }
#startBtn { cursor:pointer; border:none; background:none; width:160px; height:160px; }
#startBtn img { width:100%; height:100%; border-radius:50%; filter: drop-shadow(0 0 12px rgba(255,105,180,0.7)); animation:wiggle 1.5s infinite ease-in-out; }

.fade-out {animation:fadeOut 1.8s forwards ease-in-out;}
@keyframes fadeOut {from{opacity:1;transform:scale(1);} to{opacity:0; transform:scale(0.8);} }

#container {
  opacity: 0;
  pointer-events: none;
  width: 90vw;
  max-width: 360px;
  aspect-ratio: 360 / 650;
  margin: 20px auto;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(250,50,120,0.2);
  background: url("stellalou-letter-bg.png") no-repeat center top;
  background-size: 100% 100%;
  background-color: transparent;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  transition: opacity 1s ease-in;
  z-index: 10;
  overflow: hidden;
}
#container.show { opacity:1; pointer-events:auto; }

#letter-wrapper { flex:1; overflow-y:auto; padding:40px; box-sizing:border-box; scrollbar-width:none; }
#letter-wrapper::-webkit-scrollbar { display:none; }

#letter { font-family:'Georgia', serif; font-size:1.4rem; color:#E8C1E5; white-space:pre-wrap; position:relative; }
#letter p { margin:1.2em 0; position:relative; }
#letter p span.letter { display:inline-block; opacity:0; transform:translateY(5px); transition:opacity 0.15s ease, transform 0.15s ease; }

.ink-trail { position:absolute; border-radius:50%; pointer-events:none; background:radial-gradient(circle, rgba(255,105,180,0.6) 0%, rgba(255,105,180,0) 60%); opacity:0; transition:all 0.3s ease-out; width:4px; height:1.8rem; }

.ripple { position:fixed; border-radius:50%; background:radial-gradient(circle, rgba(255,20,147,0.8) 0%, rgba(255,20,147,0.3) 70%); width:40px; height:40px; transform:translate(-50%,-50%) scale(1); animation:ripple-anim 4s ease-out forwards; pointer-events:none; z-index:9; }
@keyframes ripple-anim {0%{transform:translate(-50%,-50%) scale(1);opacity:0.7;}100%{transform:translate(-50%,-50%) scale(80);opacity:0;} }

#heart-container {
  position:fixed;
  left:50%;
  top:50%;
  transform:translate(-50%, -50%);
  z-index:50;
  display:none;
}
#heart-container.show { display:block; }

#loveHeart { position:relative; width:100%; height:100%; }
#garden { position:absolute; top:0; left:0; }

#messages { display:none; position:absolute; width:100%; height:100%; left:0; top:0; text-align:center; color:#ff69b4; }
#elapseClock, #love-u { margin-top:20px; font-size:1.5rem; }
</style>
</head>
<body>

<div class="start-wrapper">
  <div class="start-container" id="start-container">
    <div id="click-hint">Click Here <br> ↓</div>
    <button id="startBtn"><img src="stella.png" alt="Start"></button>
  </div>
</div>

<div id="container">
  <div id="letter-wrapper">
    <h1>Sample Letter</h1>
    <div id="letter"></div>
  </div>
  <audio id="background-music" loop>
    <source src="https://github.com/eddiewei-png/letter/raw/refs/heads/main/piano%20music.mp3" type="audio/mpeg">
  </audio>
</div>

<div id="heart-container">
  <div id="loveHeart">
    <canvas id="garden"></canvas>
    <div id="messages">
      <div id="elapseClock"></div>
      <div id="love-u">Love U Forever</div>
    </div>
  </div>
</div>

<script>
// ---------------------------
// Garden.js & function.js combined
// ---------------------------
function Vector(a, b) { this.x = a; this.y = b; }
Vector.prototype = {
  rotate: function(b){ var a=this.x, c=this.y; this.x=Math.cos(b)*a-Math.sin(b)*c; this.y=Math.sin(b)*a+Math.cos(b)*c; return this },
  mult: function(a){ this.x*=a; this.y*=a; return this },
  clone: function(){ return new Vector(this.x,this.y) },
  length: function(){ return Math.sqrt(this.x*this.x+this.y*this.y) },
  subtract: function(a){ this.x-=a.x; this.y-=a.y; return this },
  set: function(a,b){ this.x=a; this.y=b; return this }
};

function Petal(a,f,b,e,c,d){
  this.stretchA=a; this.stretchB=f; this.startAngle=b; this.angle=e;
  this.bloom=d; this.growFactor=c; this.r=1; this.isfinished=false
}
Petal.prototype = {
  draw:function(){
    var a=this.bloom.garden.ctx, e,d,c,b;
    e=new Vector(0,this.r).rotate(this.bloom.startAngle*Math.PI/180);
    d=e.clone().rotate(this.angle*Math.PI/180);
    c=e.clone().mult(this.stretchA);
    b=d.clone().mult(this.stretchB);
    a.strokeStyle=this.bloom.c;
    a.beginPath();
    a.moveTo(e.x,e.y);
    a.bezierCurveTo(c.x,c.y,b.x,b.y,d.x,d.y);
    a.stroke();
  },
  render:function(){ if(this.r<=this.bloom.r){ this.r+=this.growFactor; this.draw() } else { this.isfinished=true } }
};

function Bloom(e,d,f,a,b){
  this.p=e; this.r=d; this.c=f; this.pc=a; this.petals=[]; this.garden=b; this.init(); this.garden.addBloom(this)
}
Bloom.prototype = {
  draw:function(){
    var c,b=true; this.garden.ctx.save(); this.garden.ctx.translate(this.p.x,this.p.y);
    for(var a=0;a<this.petals.length;a++){ c=this.petals[a]; c.render(); b*=c.isfinished }
    this.garden.ctx.restore(); if(b==true){ this.garden.removeBloom(this) }
  },
  init:function(){
    var c=360/this.pc; var b=Math.random()*90;
    for(var a=0;a<this.pc;a++){
      this.petals.push(new Petal(Math.random()*2.9+0.1, Math.random()*2.9+0.1, b+a*c, c, Math.random()*0.9+0.1, this))
    }
  }
};

function Garden(a,b){
  this.blooms=[]; this.element=b; this.ctx=a;
}
Garden.prototype = {
  render:function(){ for(var a=0;a<this.blooms.length;a++){ this.blooms[a].draw() } },
  addBloom:function(a){ this.blooms.push(a) },
  removeBloom:function(a){ for(var c=0;c<this.blooms.length;c++){ if(this.blooms[c]===a){ this.blooms.splice(c,1); return this }} },
  createRandomBloom:function(a,b){ this.createBloom(a,b,Math.random()*2+8,"rgba("+Math.floor(Math.random()*128+128)+","+Math.floor(Math.random()*128)+","+Math.floor(Math.random()*128)+",0.1)",Math.floor(Math.random()*7+8)) },
  createBloom:function(a,f,d,e,b){ new Bloom(new Vector(a,f),d,e,b,this) },
  clear:function(){ this.blooms=[]; this.ctx.clearRect(0,0,this.element.width,this.element.height) }
};

// ---------------------------
// Heart Animation & Letter Logic
// ---------------------------
var garden,gardenCtx,gardenCanvas,$garden,offsetX,offsetY;

$(function(){
  var $loveHeart = $("#loveHeart");
  $loveHeart.css("height",$loveHeart.width()*0.96);

  offsetX = $loveHeart.width()/2;
  offsetY = $loveHeart.height()/2-55;

  $garden = $("#garden");
  gardenCanvas = $garden[0];
  gardenCanvas.width = $loveHeart.width();
  gardenCanvas.height = $loveHeart.height();
  gardenCtx = gardenCanvas.getContext("2d");
  gardenCtx.globalCompositeOperation = "lighter";
  gardenCtx.scale($loveHeart.width()/650, $loveHeart.height()/625);
  gardenCtx.translate((1-$loveHeart.width()/650)*335,0);

  garden = new Garden(gardenCtx, gardenCanvas);
  setInterval(function(){ garden.render() }, 1000/60);
});

// Letter typewriter
const sentences=[["Line 1 行一","Line 1 English"],["Line 2 行二 Line 2 English","Line 2 English"],["Line 3 行三","Line 3 English"],["Line 4 行四","Line 4 English"],["[Your Name]"]];
const letterDiv=document.getElementById("letter");
const inkTrails=[]; for(let i=0;i<3;i++){ const ink=document.createElement("span"); ink.classList.add("ink-trail"); letterDiv.appendChild(ink); inkTrails.push(ink); }
let trailIndex=0;
function writeLetter(span,letter){ return new Promise(resolve=>{ span.textContent+=letter; requestAnimationFrame(()=>{ span.style.opacity='1'; const containerRect=letterDiv.getBoundingClientRect(); const range=document.createRange(); range.setStart(span.firstChild||span,span.textContent.length-1); range.setEnd(span.firstChild||span,span.textContent.length); const rect=range.getBoundingClientRect(); const ink=inkTrails[trailIndex%inkTrails.length]; ink.style.height=rect.height+'px'; ink.style.width=rect.width/2+'px'; ink.style.left=(rect.right-containerRect.left)+'px'; ink.style.top=(rect.top-containerRect.top)+'px'; ink.style.opacity=1; trailIndex++; setTimeout(()=>ink.style.opacity=0,400); }); resolve(); }); }
async function showSentence(lines,delay=200){ const pContainer=document.createElement("p"); letterDiv.appendChild(pContainer); if(!Array.isArray(lines)) lines=[lines]; const spans=lines.map(line=>{ const span=document.createElement("span"); span.style.display='block'; span.style.marginBottom='0.2em'; pContainer.appendChild(span); return {span,text:line}; }); const maxLength=Math.max(...lines.map(l=>l.length)); for(let i=0;i<maxLength;i++){ for(let {span,text} of spans){ if(i<text.length) await writeLetter(span,text[i]); } await new Promise(r=>setTimeout(r,delay)); letterDiv.parentElement.scrollTop=letterDiv.parentElement.scrollHeight; } }

function startHeartAnimation(){
  var c=50,d=10,b=[];
  var a=setInterval(function(){
    var h=getHeartPoint(d);
    var e=true;
    for(var f=0;f<b.length;f++){ var g=b[f]; var j=Math.sqrt(Math.pow(g[0]-h[0],2)+Math.pow(g[1]-h[1],2)); if(j<10){ e=false; break } }
    if(e){ b.push(h); garden.createRandomBloom(h[0],h[1]) }
    if(d>=30){ clearInterval(a); showMessages() } else{ d+=0.2 }
  },c);
}

function getHeartPoint(c){ 
  var t=c/Math.PI;
  var x = 19.5 * Math.pow(Math.sin(t),3)*10; 
  var y = -20*(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
  return [offsetX+x, offsetY+y]; 
}

(function(a){a.fn.typewriter=function(){this.each(function(){var d=a(this),c=d.html(),b=0; d.html(""); var e=setInterval(function(){var f=c.substr(b,1); if(f=="<"){ b=c.indexOf(">",b)+1; } else{ b++; } d.html(c.substring(0,b)+(b&1?"_":"")); if(b>=c.length) clearInterval(e); },75); }); return this; } })(jQuery);

function showMessages() { $("#messages").fadeIn(5000, function(){ $("#love-u").fadeIn(3000) }) }

async function showAllText(){ for(let s=0;s<sentences.length;s++){ await showSentence(sentences[s],300); await new Promise(r=>setTimeout(r,300)); } inkTrails.forEach(ink=>ink.style.display='none'); const container=document.getElementById("container"); container.classList.add("fade-out"); await new Promise(r=>setTimeout(r,3000)); const heartContainer=document.getElementById("heart-container"); heartContainer.classList.add("show"); startHeartAnimation(); }

document.getElementById("startBtn").addEventListener("click",function(){
  const container=document.getElementById("container");
  const startContainer=document.getElementById("start-container");
  this.disabled=true; this.style.pointerEvents="none";
  const rect=this.getBoundingClientRect();
  const centerX=rect.left+rect.width/2;
  const centerY=rect.top+rect.height/2;
  for(let i=0;i<5;i++){
    const ripple=document.createElement("span");
    ripple.className='ripple';
    ripple.style.left=centerX+'px';
    ripple.style.top=centerY+'px';
    ripple.style.animationDelay=`${i*0.3}s`;
    document.body.appendChild(ripple);
    ripple.addEventListener('animationend',()=>ripple.remove());
  }
  startContainer.classList.add('fade-out');
  setTimeout(()=>{ startContainer.style.display='none'; container.classList.add('show'); document.getElementById("background-music").play().catch(()=>console.log("Autoplay blocked")); showAllText(); },1800);
});
</script>

</body>
</html>
