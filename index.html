<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Letter Project</title>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
<!-- ‚úÖ Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
  body {
    margin: 0;
    background-color: #fdf6f8;
    font-family: 'Great Vibes', cursive;
    overflow: hidden;
  }

  #letterPage, #lovePage {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: flex; justify-content: center; align-items: center;
    background-color: #fdf6f8;
  }

  #letterPage { z-index: 2; }
  #lovePage { display: none; z-index: 1; }

  .letter {
    font-size: 28px;
    text-align: center;
    width: 80%;
    color: #b44b65;
  }

  #loveHeart {
    position: relative;
    width: 650px;
    height: 625px;
  }

  #garden {
    position: absolute;
    top: 0; left: 0;
  }

  #messages, #love-u {
    text-align: center;
    display: none;
    color: #b44b65;
    font-size: 30px;
  }
</style>
</head>
<body>

<!-- ‚ù§Ô∏è Letter page -->
<div id="letterPage">
  <div class="letter" id="letterContent">
    <p>My dearest,</p>
    <p>This letter is written from my heart...</p>
  </div>
</div>

<!-- üå∏ Heart bloom page -->
<div id="lovePage">
  <div id="loveHeart">
    <canvas id="garden"></canvas>
    <div id="messages">
      <div id="love-u">I love you ‚ù§Ô∏è</div>
    </div>
  </div>
</div>

<!-- ‚úÖ Friend's garden.js + function.js combined inline -->
<script>
/* --- GARDEN.JS --- */
function Garden(ctx, element) {
  this.blooms = [];
  this.element = element;
  this.ctx = ctx;
}
Garden.options = {
  petalCount: { min: 8, max: 15 },
  petalStretch: { min: 0.1, max: 3 },
  growFactor: { min: 0.1, max: 1 },
  bloomRadius: { min: 8, max: 10, max: 10 },
  growSpeed: 1000 / 60
};
Garden.prototype.createRandomBloom = function (x, y) {
  const radius = Math.random() * 8 + 2;
  const color = "rgba(" + Math.floor(255 * Math.random()) + "," + Math.floor(128 + 127 * Math.random()) + "," + Math.floor(200 + 55 * Math.random()) + ",0.8)";
  this.blooms.push({x, y, radius, color});
};
Garden.prototype.render = function () {
  this.ctx.clearRect(0, 0, this.element.width, this.element.height);
  for (let b of this.blooms) {
    this.ctx.beginPath();
    this.ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
    this.ctx.fillStyle = b.color;
    this.ctx.fill();
  }
};

/* --- FUNCTION.JS --- */
var $window = $(window), gardenCtx, gardenCanvas, $garden, garden;
var clientWidth = $(window).width();
var clientHeight = $(window).height();
var offsetX, offsetY;

$(function () {
  var $loveHeart = $("#loveHeart");
  offsetX = $loveHeart.width() / 2;
  offsetY = $loveHeart.height() / 2 - 55;

  $garden = $("#garden");
  gardenCanvas = $garden[0];
  gardenCanvas.width = $loveHeart.width();
  gardenCanvas.height = $loveHeart.height();
  gardenCtx = gardenCanvas.getContext("2d");
  garden = new Garden(gardenCtx, gardenCanvas);

  setInterval(function () { garden.render(); }, Garden.options.growSpeed);
});

function getHeartPoint(c) {
  var t = c / Math.PI;
  var x = 19.5 * (16 * Math.pow(Math.sin(t), 3));
  var y = -20 * (13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));
  return [offsetX + x, offsetY + y];
}

function startHeartAnimation() {
  var c = 50, d = 10, b = [];
  var a = setInterval(function () {
    var h = getHeartPoint(d);
    var e = true;
    for (var f = 0; f < b.length; f++) {
      var g = b[f];
      var j = Math.sqrt(Math.pow(g[0] - h[0], 2) + Math.pow(g[1] - h[1], 2));
      if (j < 8 * 1.3) { e = false; break; }
    }
    if (e) {
      b.push(h);
      garden.createRandomBloom(h[0], h[1]);
    }
    if (d >= 30) { clearInterval(a); showMessages(); }
    else { d += 0.2; }
  }, c);
}

/* Typewriter effect */
(function ($) {
  $.fn.typewriter = function () {
    this.each(function () {
      var $ele = $(this), content = $ele.html(), progress = 0;
      $ele.html("");
      var timer = setInterval(function () {
        var current = content.substr(progress, 1);
        if (current == "<") progress = content.indexOf(">", progress) + 1;
        else progress++;
        $ele.html(content.substring(0, progress) + (progress & 1 ? "_" : ""));
        if (progress >= content.length) clearInterval(timer);
      }, 75);
    });
    return this;
  };
})(jQuery);

function showMessages() {
  $("#messages").fadeIn(2000, function () {
    $("#love-u").fadeIn(2000);
  });
}
</script>

<!-- üåπ Page transitions -->
<script>
$(function() {
  // Typewriter start
  $("#letterContent").typewriter();

  // Fade out letter and show heart after delay
  setTimeout(() => {
    $("#letterPage").fadeOut(2000, function() {
      $("#lovePage").fadeIn(2000, function() {
        startHeartAnimation();
      });
    });
  }, 8000); // 8 seconds of letter typing before switch
});
</script>

</body>
</html>
