<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Letter Project</title>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
/* (Your original CSS - unchanged except a couple of safe pointer-events rules) */
body, html {
  margin: 0; padding: 0;
  font-family: 'Segoe UI', sans-serif;
  background: #fff0f5;
  overflow: hidden;
}

/* ===== Start Page ===== */
/* (unchanged) */
.start-wrapper {
  position: absolute; top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  z-index: 9999;
}
.start-wrapper.fade-out,
.start-container.fade-out {
  pointer-events: none; /* disable clicks only during fade out */
}
.start-container { display: flex; flex-direction: column; align-items: center; gap: 12px; text-align: center; }
#click-hint { font-size: 2.4rem; color: #ff69b4; text-shadow: 0 0 8px #ff69b4, 0 0 15px #ff1493; animation: beat 1.2s infinite; pointer-events: none; }
@keyframes beat {0%,100%{transform:scale(1);}50%{transform:scale(1.15);} }
@keyframes wiggle {0%,100%{transform:rotate(0deg);}15%{transform:rotate(-8deg);}30%{transform:rotate(6deg);}45%{transform:rotate(-6deg);}60%{transform:rotate(5deg);}75%{transform:rotate(-3deg);} }
#startBtn { cursor: pointer; border: none; background: none; width: 160px; height: 160px; z-index:10000; } /* ensure it's topmost */
#startBtn img { width: 100%; height: 100%; border-radius: 50%; filter: drop-shadow(0 0 12px rgba(255,105,180,0.7)); animation: wiggle 1.5s infinite ease-in-out; }
.fade-out {animation: fadeOut 1.8s forwards ease-in-out;}
@keyframes fadeOut {from{opacity:1;transform:scale(1);} to{opacity:0; transform:scale(0.8);} }

/* ===== Letter ===== */
/* slightly larger container across devices but responsive */
#container {
  opacity: 0;
  pointer-events: none;
  width: min(94vw, 520px);        /* increased max width */
  aspect-ratio: 360 / 650;        /* keep original letter aspect */
  margin: 20px auto;
  border-radius: 12px;
  box-shadow: 0 6px 25px rgba(250,50,120,0.2);
  background: url("stellalou-letter-bg.png") no-repeat center top;
  background-size: cover; /* cover to keep image looking right */
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  transition: opacity 1s ease-in;
  z-index: 10;
  overflow: hidden;
}
#container.show { opacity:1; pointer-events:auto; }

/* letter wrapper: padding responsive */
#letter-wrapper { flex:1; overflow-y:auto; padding: clamp(20px, 4.6vw, 44px); box-sizing:border-box; scrollbar-width:none; }
#letter-wrapper::-webkit-scrollbar { display:none; }

/* Slightly reduced letter text size and tuned line-height */
#letter { font-family:'Georgia', serif; font-size: clamp(1rem, 1.6vw, 1.18rem); color:#E8C1E5; white-space:pre-wrap; position:relative; line-height:1.6; }
#letter p { margin:1.1em 0; position:relative; }

/* ink trail styling (a little bigger for visibility) */
.ink-trail { position:absolute; border-radius:50%; pointer-events:none; background:radial-gradient(circle, rgba(255,105,180,0.6) 0%, rgba(255,105,180,0) 60%); opacity:0; transition:all 0.35s ease-out; width:6px; height:1.2rem; transform:translate(-50%,-15%); }

/* ===== Our Moments button (initially hidden) ===== */
#momentsBtn {
  display:inline-block;
  padding: 10px 18px;
  border-radius: 999px;
  border: 2px solid rgba(255,105,180,0.9);
  background: rgba(255, 255, 255, 0.03);
  color: #ff4da6;
  font-weight:700;
  text-decoration:none;
  font-family: 'Poppins', sans-serif;
  cursor:pointer;
  opacity: 0;
  transform: translateY(8px);
  transition: opacity 900ms cubic-bezier(.2,.9,.2,1), transform 600ms ease;
  box-shadow: 0 6px 18px rgba(255,105,180,0.06);
  margin-top: 14px;
  pointer-events: none;
}
#momentsBtn.visible { opacity:1; transform: translateY(0); pointer-events: auto; }

/* ===== Ripple effect ===== */
.ripple { position:fixed; border-radius:50%; background:radial-gradient(circle, rgba(255,20,147,0.8) 0%, rgba(255,20,147,0.3) 70%); width:40px; height:40px; transform:translate(-50%,-50%) scale(1); animation:ripple-anim 4s ease-out forwards; pointer-events:none; z-index:9; }
@keyframes ripple-anim {0%{transform:translate(-50%,-50%) scale(1);opacity:0.7;}100%{transform:translate(-50%,-50%) scale(80);opacity:0;} }

/* ===== Heart Canvas ===== */
#heart-container {
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 100vw;
  height: 100vh;
  z-index: 1000; /* raise it above container */
  display: none;
  overflow: visible;
  pointer-events: none;
  opacity: 0; /* start fully invisible */
  transition: opacity 1.5s ease-in;
}

#heart-container.show {
  display: block;
  opacity: 1; /* fade in smoothly */
}

#heart-container.show { display: block; }
#loveHeart { position: relative; width: 100%; height: 100%; }
#garden { width: 100%; height: 100%; display: block; }

@keyframes fadeOutToPink {
  0% {opacity:1;background-color:transparent;filter:brightness(1);}
  80% {opacity:0.3;background-color:rgba(255,182,193,0.4);filter:brightness(1.2);}
  100% {opacity:0;background-color:rgba(255,182,193,0.6);filter:brightness(1.4);}
}
#container.fade-out {animation:fadeOutToPink 3s ease forwards;}

/* timer text */
#elapseClock {
  font-family: 'Great Vibes', cursive;
  font-size: clamp(26px, 6vw, 60px);
  color: #ff8fb1;
  text-shadow: 0 0 12px rgba(255,192,203,0.7);
  opacity: 0;
  transition: opacity 1.5s ease, transform 1.5s ease;
  text-align: center;
}
#elapseClock .digit { display:inline-block; min-width:30px; text-align:center; transition: transform 0.5s ease, color 0.5s ease; font-weight:700; font-family:'Poppins',sans-serif; }
#elapseClock .digit.pulse { transform: scale(1.2); color:#ff4da6; text-shadow:0 0 12px rgba(255,105,180,0.8); }

/* small screens tweaks */
@media (max-width: 480px) {
  #container { width: 96vw; max-width: 460px; }
  #letter { font-size: clamp(0.98rem, 2.6vw, 1.06rem); }
  #momentsBtn { padding: 8px 14px; }
}

/* larger desktops */
@media (min-width: 1000px) {
  #container { width: min(72vw, 760px); aspect-ratio: 360/650; }
  #letter { font-size: clamp(1.05rem, 1.2vw, 1.35rem); }
}

/* final small polish for Great Vibes text inside heart messages */
#loveMessage { font-family: 'Great Vibes', cursive; font-size: clamp(20px, 6vw, 56px); opacity: 0; margin-bottom: 10px; transition: opacity 1.5s ease-in; white-space: nowrap; }

#messages {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  z-index: 2000; /* higher than canvas */
  width: 100%;
  pointer-events: none;
  transition: opacity 0.8s ease-in;
}
</style>
</head>
<body>

<div class="start-wrapper">
  <div class="start-container" id="start-container">
    <div id="click-hint">Click Here <br> â†“</div>
    <button id="startBtn"><img src="stella.png" alt="Start"></button>
  </div>
</div>

<div id="container">
  <div id="letter-wrapper">
    <h1 style="font-family:'Great Vibes', cursive; margin:0 0 .6em 0; font-size: clamp(28px,6vw,40px); color:#ff69b4;">To é™æŸ”</h1>
    <div id="letter"></div>

    <!-- Our Moments button (will be revealed after heart finishes drawing) -->
    <div style="text-align:center; margin-top:12px;">
      <a id="momentsBtn" href="gallery.html" role="button" aria-label="Our Moments">Our Moments</a>
    </div>
  </div>

  <audio id="background-music" loop>
    <source src="https://github.com/eddiewei-png/letter/raw/refs/heads/main/piano%20music.mp3" type="audio/mpeg">
  </audio>
</div>

<!-- Heart animation -->
<div id="heart-container">
  <div id="loveHeart">
    <canvas id="garden"></canvas>
    <div id="messages">
      <div id="loveMessage">We have been together for</div>
      <div id="elapseClock"></div>
    </div>
  </div>
</div>


<script>
let heartStarted = false;

/* ===== The bilingual lines ===== */
const sentences = [
  ["It's less than 2 months when we first met ","ä¸åˆ°ä¸¤ä¸ªæœˆå‰æˆ‘ä»¬æ‰ç¬¬ä¸€æ¬¡è§é¢"],
  ["Yet it felt like we have known each other for years now","å´æ„Ÿè§‰å¥½åƒå·²ç»è®¤è¯†ä½ å¥½å¤šå¹´äº†"],
  ["I still remember the first time when we met","æˆ‘è¿˜è®°å¾—æˆ‘ä»¬åˆæ¬¡ç›¸é‡çš„é‚£ä¸€åˆ»"],
  ["I thought that you're really beautiful","å½“æ—¶æˆ‘å°±è§‰å¾—ä½ çœŸçš„å¾ˆç¾"],
  ["I couldn't even express how happy I am","æˆ‘æ— æ³•ç”¨è¨€è¯­è¡¨è¾¾æˆ‘æœ‰å¤šå¼€å¿ƒ"],
  ["but I'm really glad to know you","ä½†æˆ‘çœŸçš„å¾ˆåº†å¹¸èƒ½è®¤è¯†ä½ "],
  ["It really changes my life so much","å› ä¸ºä½ ï¼Œæˆ‘çš„ç”Ÿæ´»æ”¹å˜äº†å¥½å¤š"],
  ["I'm looking forward to our future together!","æˆ‘å¾ˆæœŸå¾…æˆ‘ä»¬çš„æœªæ¥"],
  ["Let's make more wonderful memories together!","ä¸€èµ·åˆ›é€ æ›´å¤šç¾å¥½çš„å›å¿†å§"],
  ["- Eddie"]
];

const letterDiv = document.getElementById("letter");

/* precreate ink trails */
const inkTrails = [];
for(let i=0;i<3;i++){
  const ink=document.createElement("span");
  ink.classList.add("ink-trail");
  letterDiv.appendChild(ink);
  inkTrails.push(ink);
}
let trailIndex = 0;

/* helper: show ink under a DOM character span */
function showInkUnderSpan(charSpan) {
  if (!charSpan) return;
  const ink = inkTrails[trailIndex % inkTrails.length];
  trailIndex++;
  const containerRect = letterDiv.getBoundingClientRect();
  const rect = charSpan.getBoundingClientRect();

  // position the ink roughly under the character center and slightly below baseline
  const left = rect.left + rect.width / 2;
  const top = rect.top + rect.height * 0.78; // a bit below middle to sit under char

  ink.style.left = (left - containerRect.left) + 'px';
  ink.style.top = (top - containerRect.top) + 'px';
  ink.style.height = Math.max(10, rect.height * 1.0) + 'px';
  ink.style.width = Math.max(6, rect.width * 0.6) + 'px';

  ink.style.opacity = 1;
  ink.style.transform = "translate(-50%,-15%) scale(1)";
  // fade out a bit after showing
  setTimeout(()=> {
    ink.style.opacity = 0;
    ink.style.transform = "translate(-50%,-15%) scale(1.12)";
  }, 420);
}

/* retire unused writeLetter (kept for backwards compatibility) */
function writeLetter(span,letter){
  return new Promise(resolve=>{
    span.textContent+=letter;
    requestAnimationFrame(()=>{
      span.style.opacity='1';
      const containerRect=letterDiv.getBoundingClientRect();
      const range=document.createRange();
      range.setStart(span.firstChild||span,span.textContent.length-1);
      range.setEnd(span.firstChild||span,span.textContent.length);
      const rect=range.getBoundingClientRect();
      const ink=inkTrails[trailIndex%inkTrails.length];
      ink.style.height=rect.height+'px';
      ink.style.width=rect.width/2+'px';
      ink.style.left=(rect.right-containerRect.left)+'px';
      ink.style.top=(rect.top-containerRect.top)+'px';
      ink.style.opacity=1;
      trailIndex++;
      setTimeout(()=>ink.style.opacity=0,400);
    });
    resolve();
  });
}

/* ===== Show all text & typing ===== */
async function showAllText() {
  const container = document.getElementById("container");
  const letter = document.getElementById("letter");

  for (let i = 0; i < sentences.length; i++) {
    const [enText, cnText] = sentences[i];

    const lineDiv = document.createElement("div");
    lineDiv.classList.add("line");
    lineDiv.style.marginBottom = "1.5em";

    const enSpan = document.createElement("div");
    enSpan.classList.add("en");
    enSpan.textContent = enText;

    const cnSpan = document.createElement("div");
    cnSpan.classList.add("cn");
    cnSpan.textContent = cnText;

    lineDiv.appendChild(enSpan);
    lineDiv.appendChild(cnSpan);
    letter.appendChild(lineDiv);

    // wait until both EN + CN finish typing
    await new Promise((resolve) => typeLine(enSpan, cnSpan, resolve));
  }

  // After typing, pause briefly then fade to heart
  const bgMusic = document.getElementById("background-music");
  bgMusic.pause();
  // hide ink trails (they'll be reused later if user restarts)
  inkTrails.forEach((ink) => (ink.style.display = "none"));
  container.classList.add("fade-out");

  await new Promise((r) => setTimeout(r, 3000));
 $("#heart-container").addClass("show");
 startHeartAnimation();
}

/* ===== Garden / Heart code (kept intact, only minor add) ===== */
let garden, gardenCanvas, renderTimer;

function initGarden() {
  const $loveHeart = $("#loveHeart");
  const $gardenCanvas = $("#garden");
  gardenCanvas = $gardenCanvas[0];
  gardenCanvas.width = $loveHeart.width();
  gardenCanvas.height = $loveHeart.height();

  const ctx = gardenCanvas.getContext("2d");
  ctx.globalCompositeOperation = "lighter";

  garden = new Garden(ctx, gardenCanvas);

  if (renderTimer) clearInterval(renderTimer);
  renderTimer = setInterval(() => garden.render(), Garden.options.growSpeed);
}

function getHeartPoint(t) {
  const w = gardenCanvas.width;
  const h = gardenCanvas.height;
  const scale = Math.min(w, h) / 29;
  const aspectRatio = w / h;
  const xScale = aspectRatio < 0.8 ? 0.85 : 1;
  const yScale = 1.02;
  const x = 16 * Math.pow(Math.sin(t), 3) * scale * xScale;
  const y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t)) * scale * yScale;
  return [w / 2 + x, h / 2.05 + y - scale];
}

function startHeartAnimation() {
  if (heartStarted) return;
  heartStarted = true;
  initGarden();
  let t = 0;
  const blooms = [];
  const interval = 20;
  const step = 0.02;
  const minDistMultiplier = 0.75;
  const end = Math.PI * 2;

  const anim = setInterval(() => {
    const [x, y] = getHeartPoint(t);
    let canDraw = true;
    for (const p of blooms) {
      const dist = Math.sqrt((p[0]-x)**2 + (p[1]-y)**2);
      if (dist < Garden.options.bloomRadius.max * minDistMultiplier) {
        canDraw = false;
        break;
      }
    }

    if (canDraw) {
      blooms.push([x, y]);
      const radius = Garden.randomInt(Garden.options.bloomRadius.min, Garden.options.bloomRadius.max + 2);
      const petals = Garden.randomInt(Garden.options.petalCount.min, Garden.options.petalCount.max + 2);
      garden.createBloom(
        x,
        y,
        radius,
        Garden.randomrgba(
          Garden.options.color.rmin,
          Garden.options.color.rmax,
          Garden.options.color.gmin,
          Garden.options.color.gmax,
          Garden.options.color.bmin,
          Garden.options.color.bmax,
          Garden.options.color.opacity
        ),
        petals
      );
    }

    t += step;
    if (t >= end) {
      clearInterval(anim);

      // â›” Don't clear the renderTimer immediately â€” wait a little
      setTimeout(() => {
        clearInterval(renderTimer);
      }, 500); // give the last blooms time to settle

      // âœ… Make sure heart-container stays visible before showing messages
      $("#heart-container").css({ display: "block", opacity: 1, zIndex: 50 });

      // âœ… Wait just a bit to let the last blooms finish rendering
      setTimeout(() => {
        $("#messages").css({ display: "block", opacity: 0 }); // ensure it's present
        showMessages(); // show your love message + timer smoothly
      }, 500);

      // ğŸŒ¸ Extra pass to fill small gaps
      let extraT = 0;
      const extraStep = step / 2;
      const extraAnim = setInterval(() => {
        const [ex, ey] = getHeartPoint(extraT);
        let canDrawExtra = true;

        for (const p of blooms) {
          const dist = Math.sqrt((p[0] - ex) ** 2 + (p[1] - ey) ** 2);
          if (dist < Garden.options.bloomRadius.max * minDistMultiplier) {
            canDrawExtra = false;
            break;
          }
        }

        if (canDrawExtra) {
          blooms.push([ex, ey]);
          garden.createRandomBloom(ex, ey);
        }

        extraT += extraStep;
        if (extraT >= end) {
          clearInterval(extraAnim);

          // âœ… Reveal "Our Moments" button slightly after message appears
          setTimeout(() => {
            const btn = document.getElementById("momentsBtn");
            if (btn) btn.classList.add("visible");
          }, 3000);
        }
      }, interval);
    }
  }, interval);
} /* <<<--- THIS closing brace for startHeartAnimation was missing before; added now */

/* Garden implementation (unchanged) */
function Vector(a, b){this.x=a;this.y=b;}
Vector.prototype={rotate(b){const a=this.x,c=this.y;this.x=Math.cos(b)*a-Math.sin(b)*c;this.y=Math.sin(b)*a+Math.cos(b)*c;return this;},mult(a){this.x*=a;this.y*=a;return this;},clone(){return new Vector(this.x,this.y);}};
function Petal(a,f,b,e,c,d){this.stretchA=a;this.stretchB=f;this.startAngle=b;this.angle=e;this.bloom=d;this.growFactor=c;this.r=1;this.isfinished=false;}
Petal.prototype={draw:function(){const a=this.bloom.garden.ctx;let e,d,c,b;e=new Vector(0,this.r).rotate(Garden.degrad(this.startAngle));d=e.clone().rotate(Garden.degrad(this.angle));c=e.clone().mult(this.stretchA);b=d.clone().mult(this.stretchB);a.strokeStyle=this.bloom.c;a.beginPath();a.moveTo(e.x,e.y);a.bezierCurveTo(c.x,c.y,b.x,b.y,d.x,d.y);a.stroke();},render:function(){if(this.r<=this.bloom.r){this.r+=this.growFactor;this.draw();}else{this.isfinished=true;}}};
function Bloom(e, d, f, a, b) {
  this.p = e;
  this.r = d;
  this.c = f;
  this.pc = a;
  this.petals = [];
  this.garden = b;
  this.alpha = 0;
  this.targetAlpha = 1;
  this.alphaStep = 0.03;
  this.init();
  this.garden.addBloom(this);
}
Bloom.prototype = {
  draw: function () {
    var allFinished = true;
    var ctx = this.garden.ctx;
    if (this.alpha < this.targetAlpha) {
      this.alpha = Math.min(this.targetAlpha, this.alpha + this.alphaStep);
    }
    ctx.save();
    ctx.translate(this.p.x, this.p.y);
    var prevAlpha = ctx.globalAlpha;
    ctx.globalAlpha = prevAlpha * this.alpha;
    for (var i = 0; i < this.petals.length; i++) {
      var petal = this.petals[i];
      petal.render();
      allFinished = allFinished && petal.isfinished;
    }
    ctx.globalAlpha = prevAlpha;
    ctx.restore();
    if (allFinished) {
      this.garden.removeBloom(this);
    }
  },
  init: function () {
    var angleUnit = 360 / this.pc;
    var base = Garden.randomInt(0, 90);
    for (var i = 0; i < this.pc; i++) {
      this.petals.push(new Petal(Garden.random(Garden.options.petalStretch.min, Garden.options.petalStretch.max), Garden.random(Garden.options.petalStretch.min, Garden.options.petalStretch.max), base + i * angleUnit, angleUnit, Garden.random(Garden.options.growFactor.min, Garden.options.growFactor.max), this));
    }
  }
};
function Garden(a,b){this.blooms=[];this.element=b;this.ctx=a;}
Garden.prototype={render:function(){for(let a=0;a<this.blooms.length;a++){this.blooms[a].draw();}},addBloom:function(a){this.blooms.push(a);},removeBloom:function(a){for(let c=0;c<this.blooms.length;c++){if(this.blooms[c]===a){this.blooms.splice(c,1);return this;}}},createRandomBloom:function(a,b){this.createBloom(a,b,Garden.randomInt(Garden.options.bloomRadius.min,Garden.options.bloomRadius.max),Garden.randomrgba(Garden.options.color.rmin,Garden.options.color.rmax,Garden.options.color.gmin,Garden.options.color.gmax,Garden.options.color.bmin,Garden.options.color.bmax,Garden.options.color.opacity),Garden.randomInt(Garden.options.petalCount.min,Garden.options.petalCount.max));},createBloom:function(a,f,d,e,b){new Bloom(new Vector(a,f),d,e,b,this);},clear:function(){this.blooms=[];this.ctx.clearRect(0,0,this.element.width,this.element.height);}};
Garden.options={petalCount:{min:8,max:12},petalStretch:{min:0.1,max:1.5},growFactor:{min:0.1,max:0.6},bloomRadius:{min:5,max:8},growSpeed:1000/60,color: {rmin:128, rmax:255, gmin:0, gmax:128, bmin:0, bmax:128, opacity:0.45}};
Garden.random=function(b,a){return Math.random()*(a-b)+b;};
Garden.randomInt=function(b,a){return Math.floor(Math.random()*(a-b+1))+b;};
Garden.degrad=function(a){return 2*Math.PI/360*a;};
Garden.randomrgba = function(i, n, h, m, l, d, k) {
  const r = Math.round(Garden.random(i, n));
  const g = Math.round(Garden.random(h, m));
  const b = Math.round(Garden.random(l, d));
  return `rgba(${r},${g},${b},${k})`;
};

/* ===== DOM-ready bindings =====
   Wrap event bindings in jQuery ready so they attach even if scripts are parsed quickly.
*/
$(function() {
  // Ensure the start button binding exists and is reliable
  $("#startBtn").on("click",function(){
    const container=$("#container")[0];
    const startContainer=$("#start-container");
    this.disabled=true;
    this.style.pointerEvents="none";
    const rect=this.getBoundingClientRect();
    const centerX=rect.left+rect.width/2;
    const centerY=rect.top+rect.height/2;
    for(let i=0;i<5;i++){
      const ripple=document.createElement("span");
      ripple.className='ripple';
      ripple.style.left=centerX+'px';
      ripple.style.top=centerY+'px';
      ripple.style.animationDelay=`${i*0.3}s`;
      document.body.appendChild(ripple);
      ripple.addEventListener('animationend',()=>ripple.remove());
    }
    startContainer.addClass('fade-out');
    setTimeout(()=>{
      startContainer.hide();
      $(container).addClass('show');
      $("#background-music")[0].play().catch(()=>console.log("Autoplay blocked"));
      showAllText();
    },1800);
  });

  // Optional: allow clicking the Our Moments link anytime after it becomes visible
  $("#momentsBtn").on("click", function(e){
    // default will navigate to gallery.html; if you want a different behavior, intercept here
  });
});
</script>

<script>
function showMessages() {
  const messages = $("#messages");
  const loveMessage = $("#loveMessage");
  const elapseClock = $("#elapseClock");

  // Ensure messages are on top of canvas and visible
  messages.css({ display: "block", opacity: 1, zIndex: 1001, pointerEvents: "none" });

  // Make sure timer content is populated before we animate it
  updateElapsedTime();
  clearInterval(window.timerInterval);
  window.timerInterval = setInterval(updateElapsedTime, 1000);

  // Step 1: Fade + float in the "We have been together" text (using your Great Vibes)
  loveMessage
    .stop(true, true)
    .css({ opacity: 0 })
    .animate({ opacity: 1 }, 1100, "swing", function () {
      // Step 2: Fade in the timer after the love message
      setTimeout(() => {
        elapseClock
          .stop(true, true)
          .css({ opacity: 0 })
          .animate({ opacity: 1 }, 1400, "swing", function () {
            // Step 3: Final signature
            let finalMessage = $("#finalMessage");
            if (finalMessage.length === 0) {
              finalMessage = $(` 
                <div id="finalMessage">
                  Loving you forever<br>â€“ Eddie
                </div>
              `).css({
                opacity: 0,
                fontSize: "clamp(26px, 3vw, 36px)",
                textAlign: "center",
                marginTop: "25px",
                fontFamily: "'Great Vibes', cursive",
                color: "#ff69b4",
                textShadow: "0 0 12px rgba(255,192,203,0.7)",
              }).appendTo(messages);
            }

            setTimeout(() => {
              finalMessage.animate({ opacity: 1 }, 1200, "swing");
            }, 600);
          });
      }, 400);
    });
}

function updateElapsedTime() {
  const startTime = new Date("2025-10-07T22:30:00");
  const now = new Date();
  const diff = now - startTime;

  if (diff < 0) return;

  const days = Math.floor(diff / (1000 * 60 * 60 * 24));
  const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
  const minutes = Math.floor((diff / (1000 * 60)) % 60);
  const seconds = Math.floor((diff / 1000) % 60);

  const elapseClock = $("#elapseClock");
  elapseClock.html(`
    <span class="digit">${days}</span> days&nbsp;
    <span class="digit">${hours.toString().padStart(2,'0')}</span> hours&nbsp;
    <span class="digit">${minutes.toString().padStart(2,'0')}</span> minutes&nbsp;
    <span class="digit">${seconds.toString().padStart(2,'0')}</span> seconds
  `);

  // Gentle pulse for seconds digit
  const secondsDigit = elapseClock.find(".digit").last();
  secondsDigit.addClass("pulse");
  setTimeout(() => secondsDigit.removeClass("pulse"), 500);
}
</script>

<script>
// ğŸ’– Ink Glow Typewriter â€” smooth, natural, synchronized bilingual fade-in (speeded up)
async function typeLine(enElement, cnElement, done) {
  const enText = enElement.textContent || "";
  const cnText = cnElement.textContent || "";
  enElement.textContent = "";
  cnElement.textContent = "";

  const lenE = enText.length;
  const lenC = cnText.length;

  // Tuned for slightly faster typing but still smooth
  const baseDelay = 70;   // was 110 -> faster
  const jitter = 18;      // less jitter for steadier rhythm
  const endPause = 900;   // shorter pause after each line

  const wrapper = document.getElementById("letter-wrapper");

  // create per-character spans
  const createSpan = (char) => {
    const span = document.createElement("span");
    span.textContent = char;
    span.style.opacity = 0;
    span.style.transition = "opacity 0.55s ease, text-shadow 0.45s ease";
    return span;
  };

  const enSpans = [...enText].map(createSpan);
  const cnSpans = [...cnText].map(createSpan);
  enSpans.forEach(s => enElement.appendChild(s));
  cnSpans.forEach(s => cnElement.appendChild(s));

  // steps chosen so both finish together
  const steps = Math.max(6, lenE, lenC);

  for (let s = 0; s < steps; s++) {
    const eIndex = Math.round((s / (steps - 1 || 1)) * lenE);
    const cIndex = Math.round((s / (steps - 1 || 1)) * lenC);

    // reveal english up to eIndex
    for (let i = 0; i < eIndex; i++) {
      if (enSpans[i] && enSpans[i].style.opacity === "0") {
        enSpans[i].style.opacity = 1;
        enSpans[i].style.textShadow = '0 0 7px rgba(255,182,193,0.85)';
        setTimeout(()=> enSpans[i].style.textShadow = '0 0 0 rgba(0,0,0,0)', 380);
        showInkUnderSpan(enSpans[i]);
      }
    }

    // reveal chinese up to cIndex
    for (let j = 0; j < cIndex; j++) {
      if (cnSpans[j] && cnSpans[j].style.opacity === "0") {
        cnSpans[j].style.opacity = 1;
        cnSpans[j].style.textShadow = '0 0 7px rgba(255,182,193,0.85)';
        setTimeout(()=> cnSpans[j].style.textShadow = '0 0 0 rgba(0,0,0,0)', 380);
        showInkUnderSpan(cnSpans[j]);
      }
    }

    // autoscroll
    wrapper.scrollTop = wrapper.scrollHeight;

    // small randomized delay for natural pacing
    const delay = Math.max(20, baseDelay + (Math.random() - 0.5) * jitter);
    await new Promise(r => setTimeout(r, delay));
  }

  // ensure fully visible
  enSpans.forEach(s => { s.style.opacity = 1; s.style.textShadow = '0 0 0 rgba(0,0,0,0)'; });
  cnSpans.forEach(s => { s.style.opacity = 1; s.style.textShadow = '0 0 0 rgba(0,0,0,0)'; });

  wrapper.scrollTop = wrapper.scrollHeight;
  await new Promise(r => setTimeout(r, endPause));
  done();
}
</script>
</body>
</html>






