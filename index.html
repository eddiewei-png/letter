<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Letter Project</title>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
body, html {
  margin: 0; padding: 0;
  font-family: 'Segoe UI', sans-serif;
  background: #fff0f5;
  overflow: hidden;
}

/* ===== Start Page ===== */
.start-wrapper {
  position: absolute; top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  z-index: 100;
}
.start-container { display: flex; flex-direction: column; align-items: center; gap: 12px; text-align: center; }
#click-hint { font-size: 2.4rem; color: #ff69b4; text-shadow: 0 0 8px #ff69b4, 0 0 15px #ff1493; animation: beat 1.2s infinite; pointer-events: none; }
@keyframes beat {0%,100%{transform:scale(1);}50%{transform:scale(1.15);} }
@keyframes wiggle {0%,100%{transform:rotate(0deg);}15%{transform:rotate(-8deg);}30%{transform:rotate(6deg);}45%{transform:rotate(-6deg);}60%{transform:rotate(5deg);}75%{transform:rotate(-3deg);} }
#startBtn { cursor: pointer; border: none; background: none; width: 160px; height: 160px; }
#startBtn img { width: 100%; height: 100%; border-radius: 50%; filter: drop-shadow(0 0 12px rgba(255,105,180,0.7)); animation: wiggle 1.5s infinite ease-in-out; }
.fade-out {animation: fadeOut 1.8s forwards ease-in-out;}
@keyframes fadeOut {from{opacity:1;transform:scale(1);} to{opacity:0; transform:scale(0.8);} }

/* ===== Letter ===== */
#container {
  opacity: 0;
  pointer-events: none;
  width: 90vw;
  max-width: 360px;
  aspect-ratio: 360 / 650;
  margin: 20px auto;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(250,50,120,0.2);
  background: url("stellalou-letter-bg.png") no-repeat center top;
  background-size: 100% 100%;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  transition: opacity 1s ease-in;
  z-index: 10;
  overflow: hidden;
}
#container.show { opacity:1; pointer-events:auto; }

#letter-wrapper { flex:1; overflow-y:auto; padding:40px; box-sizing:border-box; scrollbar-width:none; }
#letter-wrapper::-webkit-scrollbar { display:none; }
#letter { font-family:'Georgia', serif; font-size:1.4rem; color:#E8C1E5; white-space:pre-wrap; position:relative; }
#letter p { margin:1.2em 0; position:relative; }
.ink-trail { position:absolute; border-radius:50%; pointer-events:none; background:radial-gradient(circle, rgba(255,105,180,0.6) 0%, rgba(255,105,180,0) 60%); opacity:0; transition:all 0.3s ease-out; width:4px; height:1.8rem; }

/* ===== Ripple effect ===== */
.ripple { position:fixed; border-radius:50%; background:radial-gradient(circle, rgba(255,20,147,0.8) 0%, rgba(255,20,147,0.3) 70%); width:40px; height:40px; transform:translate(-50%,-50%) scale(1); animation:ripple-anim 4s ease-out forwards; pointer-events:none; z-index:9; }
@keyframes ripple-anim {0%{transform:translate(-50%,-50%) scale(1);opacity:0.7;}100%{transform:translate(-50%,-50%) scale(80);opacity:0;} }

/* ===== Heart Canvas ===== */
#heart-container {
  position: fixed;
  left: 50%; top: 50%;
  transform: translate(-50%, -50%);
  width: 100vw; height: 100vh;
  z-index: 50;
  display: none;
  overflow: visible;
}
#heart-container.show { display: block; }
#loveHeart { position: relative; width: 100%; height: 100%; }
#garden { width: 100%; height: 100%; display: block; }
#messages {
  display: none;
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  color: #ff69b4;
}
#love-u { display: none; font-size: 2rem; margin-top: 10px; }

@keyframes fadeOutToPink {
  0% {opacity:1;background-color:transparent;filter:brightness(1);}
  80% {opacity:0.3;background-color:rgba(255,182,193,0.4);filter:brightness(1.2);}
  100% {opacity:0;background-color:rgba(255,182,193,0.6);filter:brightness(1.4);}
}
#container.fade-out {animation:fadeOutToPink 3s ease forwards;}

#elapseClock {
  font-family: 'Great Vibes', cursive;
  font-size: 2.5rem;
  color: #ff8fb1;
  text-shadow: 0 0 12px rgba(255,192,203,0.7);
  opacity: 0; /* start hidden */
  transition: all 1s ease-out;
  text-align: center;
}

#elapseClock .digit {
  display: inline-block;
  min-width: 30px;
  text-align: center;
  transition: transform 0.5s ease, color 0.5s ease;
}

#elapseClock .digit.pulse {
  transform: scale(1.2);
  color: #ff4da6; /* brighter pink for pulse */
  text-shadow: 0 0 12px rgba(255,105,180,0.8);
}

#messages {
  display: none; /* start hidden, revealed by heart */
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  color: #ff69b4;
}

@keyframes floatIn {
  from {opacity: 0; transform: translateY(15px);}
  to {opacity: 1; transform: translateY(0);}
}
</style>
</head>
<body>

<div class="start-wrapper">
  <div class="start-container" id="start-container">
    <div id="click-hint">Click Here <br> ↓</div>
    <button id="startBtn"><img src="stella.png" alt="Start"></button>
  </div>
</div>

<div id="container">
  <div id="letter-wrapper">
    <h1>Sample Letter</h1>
    <div id="letter"></div>
  </div>
  <audio id="background-music" loop>
    <source src="https://github.com/eddiewei-png/letter/raw/refs/heads/main/piano%20music.mp3" type="audio/mpeg">
  </audio>
</div>

<!-- Heart animation -->
<div id="heart-container">
  <div id="loveHeart">
    <canvas id="garden"></canvas>
    <div id="messages">
      <div id="elapseClock"></div>
    </div>
  </div>
</div>


<script>
/* ===== Letter typing effect (same as before) ===== */
const sentences = [
  ["Line 1 行一","Line 1 English"],
  ["Line 2 行二行二行二 Line 2 English 行二行二行二","Line 2 English 行二行二行二 Line 2 English"],
  ["Line 3 行三","Line 3 English"],
  ["Line 4 行四","Line 4 English"],
  ["[Your Name]"]
];
const letterDiv = document.getElementById("letter");
const inkTrails = [];
for(let i=0;i<3;i++){
  const ink=document.createElement("span");
  ink.classList.add("ink-trail");
  letterDiv.appendChild(ink);
  inkTrails.push(ink);
}
let trailIndex = 0;
function writeLetter(span,letter){
  return new Promise(resolve=>{
    span.textContent+=letter;
    requestAnimationFrame(()=>{
      span.style.opacity='1';
      const containerRect=letterDiv.getBoundingClientRect();
      const range=document.createRange();
      range.setStart(span.firstChild||span,span.textContent.length-1);
      range.setEnd(span.firstChild||span,span.textContent.length);
      const rect=range.getBoundingClientRect();
      const ink=inkTrails[trailIndex%inkTrails.length];
      ink.style.height=rect.height+'px';
      ink.style.width=rect.width/2+'px';
      ink.style.left=(rect.right-containerRect.left)+'px';
      ink.style.top=(rect.top-containerRect.top)+'px';
      ink.style.opacity=1;
      trailIndex++;
      setTimeout(()=>ink.style.opacity=0,400);
    });
    resolve();
  });
}
async function showSentence(lines,delay=200){
  const pContainer=document.createElement("p");
  letterDiv.appendChild(pContainer);
  if(!Array.isArray(lines)) lines=[lines];
  const spans=lines.map(line=>{
    const span=document.createElement("span");
    span.style.display='block';
    span.style.marginBottom='0.2em';
    pContainer.appendChild(span);
    return {span,text:line};
  });
  const maxLength=Math.max(...lines.map(l=>l.length));
  for(let i=0;i<maxLength;i++){
    for(let {span,text} of spans){
      if(i<text.length) await writeLetter(span,text[i]);
    }
    await new Promise(r=>setTimeout(r,delay));
    letterDiv.parentElement.scrollTop=letterDiv.parentElement.scrollHeight;
  }
}
async function showAllText(){
  for (let s=0;s<sentences.length;s++){
    await showSentence(sentences[s],300);
    await new Promise(r=>setTimeout(r,300));
  }
  inkTrails.forEach(ink=>ink.style.display='none');
  const container=document.getElementById("container");
  container.classList.add("fade-out");
  await new Promise(r=>setTimeout(r,3000));
  $("#heart-container").fadeIn();
  startHeartAnimation();
}

/* ===== Fixed Heart Animation ===== */
let garden, gardenCanvas;
function initGarden(){
  const $loveHeart=$("#loveHeart");
  const $gardenCanvas=$("#garden");
  gardenCanvas=$gardenCanvas[0];
  gardenCanvas.width=$loveHeart.width();
  gardenCanvas.height=$loveHeart.height();
  const ctx=gardenCanvas.getContext("2d");
  ctx.globalCompositeOperation="lighter";
  garden=new Garden(ctx,gardenCanvas);
  setInterval(()=>garden.render(),Garden.options.growSpeed);
}

function getHeartPoint(t) {
  const w = gardenCanvas.width;
  const h = gardenCanvas.height;

  // Base scale relative to the smaller screen dimension
  const scale = Math.min(w, h) / 29;

  // Adjust horizontal compression on portrait (tall) screens
  const aspectRatio = w / h;
  const xScale = aspectRatio < 0.8 ? 0.85 : 1; // compress a bit if very tall
  const yScale = 1.02; // slight stretch vertically to keep shape natural

  const x = 16 * Math.pow(Math.sin(t), 3) * scale * xScale;
  const y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t)
            - 2 * Math.cos(3 * t) - Math.cos(4 * t)) * scale * yScale;

  // Center perfectly and shift slightly upward to prevent bottom clipping
  return [w / 2 + x, h / 2.05 + y - scale];
}

function startHeartAnimation() {
  initGarden();
  let t = 0;
  const blooms = [];
  const interval = 25;
  const step = 0.04;
  const end = Math.PI * 2;

  const anim = setInterval(() => {
    const [x, y] = getHeartPoint(t);
    let canDraw = true;
    for (const p of blooms) {
      const dist = Math.sqrt((p[0]-x)**2 + (p[1]-y)**2);
      if (dist < Garden.options.bloomRadius.max * 1.5) {
        canDraw = false;
        break;
      }
    }
    if (canDraw) {
      blooms.push([x, y]);
      garden.createRandomBloom(x, y);
    }
    t += step;
    if (t >= end) {
      clearInterval(anim);
      showMessages();
    }
  }, interval);
}

//function showMessages(){
//  $("#messages").fadeIn(3000, ()=>$("#love-u").fadeIn(2000));
//}


//function showMessages() {
  //$("#messages").fadeIn(3000, () => {
    //setInterval(updateTimer, 1000);
    //updateTimer(); // Initial call so it shows immediately
  //  $("#love-u").fadeIn(2000);
//  });
//}

/* ===== Garden.js ===== */
function Vector(a, b){this.x=a;this.y=b;}
Vector.prototype={rotate(b){const a=this.x,c=this.y;this.x=Math.cos(b)*a-Math.sin(b)*c;this.y=Math.sin(b)*a+Math.cos(b)*c;return this;},mult(a){this.x*=a;this.y*=a;return this;},clone(){return new Vector(this.x,this.y);}};
function Petal(a,f,b,e,c,d){this.stretchA=a;this.stretchB=f;this.startAngle=b;this.angle=e;this.bloom=d;this.growFactor=c;this.r=1;this.isfinished=false;}
Petal.prototype={draw:function(){const a=this.bloom.garden.ctx;let e,d,c,b;e=new Vector(0,this.r).rotate(Garden.degrad(this.startAngle));d=e.clone().rotate(Garden.degrad(this.angle));c=e.clone().mult(this.stretchA);b=d.clone().mult(this.stretchB);a.strokeStyle=this.bloom.c;a.beginPath();a.moveTo(e.x,e.y);a.bezierCurveTo(c.x,c.y,b.x,b.y,d.x,d.y);a.stroke();},render:function(){if(this.r<=this.bloom.r){this.r+=this.growFactor;this.draw();}else{this.isfinished=true;}}};
function Bloom(e, d, f, a, b) {
  this.p = e;
  this.r = d;
  this.c = f;      // color string with final opacity
  this.pc = a;
  this.petals = [];
  this.garden = b;
  this.alpha = 0;          // current alpha multiplier (0..1)
  this.targetAlpha = 1;    // multiply by color's own opacity
  this.alphaStep = 0.03;   // speed of fade-in (tweak to taste)
  this.init();
  this.garden.addBloom(this);
}

Bloom.prototype = {
  draw: function () {
    var allFinished = true;
    var ctx = this.garden.ctx;

    // Fade-in logic
    if (this.alpha < this.targetAlpha) {
      this.alpha = Math.min(this.targetAlpha, this.alpha + this.alphaStep);
    }

    ctx.save();
    ctx.translate(this.p.x, this.p.y);

    // apply bloom alpha by multiplying globalAlpha
    var prevAlpha = ctx.globalAlpha;
    ctx.globalAlpha = prevAlpha * this.alpha;

    for (var i = 0; i < this.petals.length; i++) {
      var petal = this.petals[i];
      petal.render();
      allFinished = allFinished && petal.isfinished;
    }

    ctx.globalAlpha = prevAlpha;
    ctx.restore();

    if (allFinished) {
      this.garden.removeBloom(this);
    }
  },

  init: function () {
    var angleUnit = 360 / this.pc;
    var base = Garden.randomInt(0, 90);
    for (var i = 0; i < this.pc; i++) {
      this.petals.push(
        new Petal(
          Garden.random(Garden.options.petalStretch.min, Garden.options.petalStretch.max),
          Garden.random(Garden.options.petalStretch.min, Garden.options.petalStretch.max),
          base + i * angleUnit,
          angleUnit,
          Garden.random(Garden.options.growFactor.min, Garden.options.growFactor.max),
          this
        )
      );
    }
  }
};

function Garden(a,b){this.blooms=[];this.element=b;this.ctx=a;}
Garden.prototype={render:function(){for(let a=0;a<this.blooms.length;a++){this.blooms[a].draw();}},addBloom:function(a){this.blooms.push(a);},removeBloom:function(a){for(let c=0;c<this.blooms.length;c++){if(this.blooms[c]===a){this.blooms.splice(c,1);return this;}}},createRandomBloom:function(a,b){this.createBloom(a,b,Garden.randomInt(Garden.options.bloomRadius.min,Garden.options.bloomRadius.max),Garden.randomrgba(Garden.options.color.rmin,Garden.options.color.rmax,Garden.options.color.gmin,Garden.options.color.gmax,Garden.options.color.bmin,Garden.options.color.bmax,Garden.options.color.opacity),Garden.randomInt(Garden.options.petalCount.min,Garden.options.petalCount.max));},createBloom:function(a,f,d,e,b){new Bloom(new Vector(a,f),d,e,b,this);},clear:function(){this.blooms=[];this.ctx.clearRect(0,0,this.element.width,this.element.height);}};

Garden.options={petalCount:{min:8,max:12},petalStretch:{min:0.1,max:1.5},growFactor:{min:0.1,max:0.6},bloomRadius:{min:5,max:8},growSpeed:1000/60,color: {rmin:128, rmax:255, gmin:0, gmax:128, bmin:0, bmax:128, opacity:0.45}};
Garden.random=function(b,a){return Math.random()*(a-b)+b;};
Garden.randomInt=function(b,a){return Math.floor(Math.random()*(a-b+1))+b;};
Garden.degrad=function(a){return 2*Math.PI/360*a;};
Garden.randomrgba = function(i, n, h, m, l, d, k) {
  const r = Math.round(Garden.random(i, n));
  const g = Math.round(Garden.random(h, m));
  const b = Math.round(Garden.random(l, d));
  return `rgba(${r},${g},${b},${k})`;
};


/* ===== Start Button ===== */
$("#startBtn").on("click",function(){
  const container=$("#container")[0];
  const startContainer=$("#start-container");
  this.disabled=true;
  this.style.pointerEvents="none";
  const rect=this.getBoundingClientRect();
  const centerX=rect.left+rect.width/2;
  const centerY=rect.top+rect.height/2;
  for(let i=0;i<5;i++){
    const ripple=document.createElement("span");
    ripple.className='ripple';
    ripple.style.left=centerX+'px';
    ripple.style.top=centerY+'px';
    ripple.style.animationDelay=`${i*0.3}s`;
    document.body.appendChild(ripple);
    ripple.addEventListener('animationend',()=>ripple.remove());
  }
  startContainer.addClass('fade-out');
  setTimeout(()=>{
    startContainer.hide();
    $(container).addClass('show');
    $("#background-music")[0].play().catch(()=>console.log("Autoplay blocked"));
    showAllText();
  },1800);
});
</script>
<script>
/* ===== Smoothly updating live timer ===== */
function updateElapsedTime() {
  const startTime = new Date("2025-10-07T22:30:00"); // start date/time
  const now = new Date();
  const diff = now - startTime;

  if (diff < 0) {
    document.getElementById("elapseClock").innerText = "Counting soon ❤️";
    return;
  }

  const days = Math.floor(diff / (1000 * 60 * 60 * 24));
  const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
  const minutes = Math.floor((diff / (1000 * 60)) % 60);
  const seconds = Math.floor((diff / 1000) % 60);

  const elapseClock = $("#elapseClock");
  elapseClock.html(`
    <span class="digit">${days}</span> days&nbsp;
    <span class="digit">${hours.toString().padStart(2,'0')}</span> hours&nbsp;
    <span class="digit">${minutes.toString().padStart(2,'0')}</span> minutes&nbsp;
    <span class="digit">${seconds.toString().padStart(2,'0')}</span> seconds
  `);

  // Pulse the seconds digit
  const secondsDigit = elapseClock.find(".digit").last();
  secondsDigit.addClass("pulse");
  setTimeout(() => secondsDigit.removeClass("pulse"), 500);
}

/*function updateElapsedTime() {
  const startTime = new Date("2025-10-07T22:30:00"); // start from Oct 7, 2025, 22:30
  const now = new Date();
  const diff = now - startTime;

  const elapseClock = document.getElementById("elapseClock");

  if (diff < 0) {
    elapseClock.innerText = "Counting soon ❤️";
    return;
  }

  const days = Math.floor(diff / (1000 * 60 * 60 * 24));
  const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
  const minutes = Math.floor((diff / (1000 * 60)) % 60);
  const seconds = Math.floor((diff / 1000) % 60);

  // Create a softly animated transition each update
  elapseClock.style.opacity = "0";
  elapseClock.style.transform = "translateY(8px)";
  setTimeout(() => {
    elapseClock.innerHTML = `
      <span class="digit">${days}</span> days&nbsp;
      <span class="digit">${hours.toString().padStart(2, '0')}</span> hrs&nbsp;
      <span class="digit">${minutes.toString().padStart(2, '0')}</span> min&nbsp;
      <span class="digit">${seconds.toString().padStart(2, '0')}</span> sec
    `;
    elapseClock.style.opacity = "1";
    elapseClock.style.transform = "translateY(0)";
  }, 150);
}
*/

// Make sure it starts when the heart message fades in
/*function showMessages() {
  $("#messages").fadeIn(2500, () => {
    updateElapsedTime();
    setInterval(updateElapsedTime, 1000);
    $("#love-u").fadeIn(2000);
  });
}*/
function showMessages() {
  // Fade in the container first
  $("#messages").fadeIn(2000, () => {
    // Animate the timer smoothly
    const elapseClock = $("#elapseClock");
    elapseClock.css({opacity: 0, transform: "translateY(20px)"}).show();
    elapseClock.animate({opacity: 1, top: '0px'}, {
      duration: 1500,
      step: function(now, fx) {
        elapseClock.css("transform", `translateY(${20 * (1-now)}px)`);
      },
      complete: function() {
        // Start the live timer
        updateElapsedTime();
        setInterval(updateElapsedTime, 1000);
      }
    });
  });
}


</script>


</body>
</html>

















